<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Pengumpulan Tugas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" />
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
      /* --- VARIABEL CSS BARU & GLOBAL STYLES --- */
      :root {
        --primary-color: #007bff; /* Biru cerah untuk aksi utama */
        --secondary-color: #28a745; /* Hijau untuk sukses/masuk */
        --danger-color: #dc3545; /* Merah untuk bahaya/keluar */
        --background-light: #f8f9fa; /* Warna latar belakang lebih terang dan bersih */
        --card-background: #ffffff;
        --text-dark: #212529; /* Teks lebih gelap, standar Bootstrap */
        --text-muted: #6c757d; /* Teks sekunder, standar Bootstrap */
        --border-color: #dee2e6; /* Warna border standar */
        --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --shadow-md: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
      }

      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--background-light);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        color: var(--text-dark);
        padding-top: 105px; /* Sesuaikan dengan tinggi running text (35px) + navbar (70px) */
        transition: background-color 0.3s ease;
      }

      /* --- RUNNING TEXT (PENGUMUMAN) --- */
      .running-text-container {
        background: linear-gradient(90deg, #dc3545 0%, #e74c3c 100%); /* Gradien merah yang lebih modern */
        color: white;
        padding: 8px 0;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 35px;
        z-index: 1000;
        box-shadow: var(--shadow-sm);
        display: flex; /* Tambahkan flexbox untuk centering */
        align-items: center;
        overflow: hidden; /* Pastikan teks berjalan tidak keluar */
      }
      .running-text-container span {
        white-space: nowrap;
        font-size: 0.9rem;
        font-weight: 500;
        animation: marquee 25s linear infinite; /* Kecepatan bisa disesuaikan */
        padding-left: 100%; /* Mulai dari luar layar */
      }
      @keyframes marquee {
        0% {
          transform: translateX(0%);
        }
        100% {
          transform: translateX(-100%);
        }
      }

      /* --- NAVBAR --- */
      .navbar {
        background-color: var(--primary-color);
        color: white;
        padding: 10px 20px; /* Padding lebih nyaman */
        position: fixed;
        top: 35px; /* Tepat di bawah running text */
        left: 0;
        width: 100%;
        z-index: 999;
        box-shadow: var(--shadow-md);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap; /* Penting untuk responsivitas */
        min-height: 70px; /* Tinggi minimum navbar */
      }
      .navbar-brand {
        font-weight: 700;
        font-size: 1.25rem;
        display: flex;
        align-items: center;
        gap: 8px; /* Jarak antara ikon dan teks */
      }
      .navbar-brand img {
        height: 28px; /* Ukuran ikon rumah */
        width: auto;
        filter: brightness(1.2); /* Sedikit cerahkan ikon */
      }
      .navbar-links {
        display: flex;
        gap: 25px; /* Jarak antar link lebih lebar */
        margin-left: 20px;
      }
      .navbar-links a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        padding: 5px 0;
        position: relative;
        transition: color 0.3s ease;
      }
      .navbar-links a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -2px; /* Sedikit di bawah teks */
        width: 0;
        height: 2px;
        background-color: #fff; /* Garis putih */
        transition: width 0.3s ease;
      }
      .navbar-links a:hover::after,
      .navbar-links a.active::after {
        width: 100%;
        background-color: #ffd700; /* Warna kuning emas untuk aktif/hover */
      }
      .navbar-links a:hover,
      .navbar-links a.active {
        color: #ffd700; /* Warna kuning emas untuk teks aktif/hover */
      }
      .navbar-user-info {
        display: flex;
        align-items: center;
        gap: 15px;
        color: white;
        font-size: 0.9rem;
        text-align: right;
      }
      .navbar-user-info span {
        display: block;
        line-height: 1.2;
      }
      .navbar-user-info .user-name {
        font-weight: 600;
      }
      .navbar-user-info .user-nim,
      .navbar-user-info .user-email {
        font-size: 0.8rem;
        opacity: 0.9;
      }
      .navbar-profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid white; /* Border putih */
        box-shadow: var(--shadow-sm);
      }
      .logout-btn {
        background-color: var(--danger-color);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      .logout-btn:hover {
        background-color: #c82333; /* Merah sedikit lebih gelap */
        transform: translateY(-1px);
      }

      /* --- GLOBAL CARD & HEADER --- */
      .header-info {
        background-color: var(--card-background);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        padding: 25px;
        margin-bottom: 25px;
        text-align: center;
        width: 100%;
        max-width: 500px; /* Batasi lebar */
      }
      .header-info h1 {
        color: var(--text-dark);
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .header-info p {
        color: var(--text-muted);
        font-size: 0.95rem;
        line-height: 1.4;
      }
      .container {
        padding: 15px;
        max-width: 500px; /* Lebar maksimum untuk konten utama */
        width: 100%;
      }
      .card {
        background: var(--card-background);
        border-radius: 12px;
        box-shadow: var(--shadow-md); /* Bayangan sedang */
        padding: 30px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg); /* Bayangan lebih dalam saat hover */
      }
      h2 {
        color: var(--text-dark);
        font-weight: 700;
        margin-bottom: 10px;
        font-size: 1.75rem; /* Ukuran judul h2 */
      }
      .sub-text {
        color: var(--text-muted);
        margin-bottom: 25px;
        font-size: 0.95rem;
      }
      .form-group label {
        color: var(--text-dark);
        font-weight: 500;
        margin-bottom: 8px;
        display: block; /* Agar label di atas select */
      }
      .form-group select {
        border: 1px solid var(--border-color);
        background-color: #ffffff;
        padding: 10px 15px;
        border-radius: 8px;
        width: 100%;
        font-size: 1rem;
        color: var(--text-dark);
        appearance: none; /* Hilangkan default arrow */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236c757d'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); /* Custom arrow */
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 20px;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .form-group select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* Focus ring */
        outline: none;
      }

      /* --- UPLOAD AREA --- */
      .custom-file-upload {
        width: 180px; /* Ukuran sedikit lebih besar */
        height: 180px;
        border: 3px dashed var(--primary-color); /* Biru primer */
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 25px auto 15px auto; /* Tengah dengan margin atas bawah */
        background-color: #f0f8ff; /* Warna latar belakang ringan */
      }
      .custom-file-upload:hover {
        border-color: var(--secondary-color); /* Hijau saat hover */
        background-color: #e6f7ff; /* Latar belakang lebih cerah */
        transform: scale(1.03);
      }
      .custom-file-upload img {
        width: 80px; /* Ikon lebih besar */
        height: 80px;
        opacity: 0.8;
        filter: invert(10%) sepia(85%) saturate(300%) hue-rotate(180deg) brightness(95%) contrast(90%); /* Warna biru ikon */
      }
      .custom-file-upload span {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-top: 10px;
        text-align: center;
        line-height: 1.3;
      }
      #uploadButton {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.1rem;
        transition: background-color 0.2s ease, transform 0.1s ease;
        width: 100%;
        margin-top: 20px;
      }
      #uploadButton:hover {
        background-color: #0056b3; /* Biru lebih gelap */
        transform: translateY(-1px);
      }
      #uploadButton:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        transform: none;
      }
      .file-name-display {
        margin-top: 10px;
        font-size: 0.9rem;
        color: var(--text-dark);
        font-weight: 500;
        text-align: center;
      }

      /* --- PROGRESS & STATUS DIALOGS --- */
      .progress-bar-container {
        background-color: #e9ecef; /* Latar belakang progress bar */
        border-radius: 5px;
        height: 8px;
        margin-top: 15px;
        overflow: hidden;
      }
      .progress-bar {
        background-color: var(--secondary-color);
        height: 100%;
        width: 0%;
        border-radius: 5px;
        transition: width 0.3s ease;
      }
      .dialog-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Overlay lebih gelap */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .dialog-container.show {
        opacity: 1;
        visibility: visible;
      }
      .dialog-card {
        background-color: var(--card-background);
        border-radius: 15px;
        padding: 40px 30px;
        text-align: center;
        box-shadow: var(--shadow-lg);
        max-width: 450px;
        width: 90%;
        animation: fadeInScale 0.3s ease-out;
      }
      @keyframes fadeInScale {
        0% {
          opacity: 0;
          transform: scale(0.9);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }
      .dialog-card h3 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--text-dark);
      }
      .dialog-card p {
        font-size: 1.05rem;
        color: var(--text-muted);
        line-height: 1.5;
        margin-bottom: 25px;
      }
      .dialog-card .dialog-button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.05rem;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      .dialog-card .dialog-button:hover {
        background-color: #0056b3;
        transform: translateY(-1px);
      }
      .dialog-card img {
        width: 80px;
        height: 80px;
        margin-bottom: 20px;
      }
      .dialog-card .dialog-icon {
        font-size: 4rem; /* Ukuran ikon di dialog */
        margin-bottom: 20px;
      }
      .dialog-card .success-icon {
        color: var(--secondary-color);
      }
      .dialog-card .error-icon {
        color: var(--danger-color);
      }
      .dialog-card .info-icon {
        color: var(--primary-color);
      }
      .dialog-card .warning-icon {
        color: #ffc107;
      }

      /* --- LOGIN SCREEN --- */
      .login-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--background-light);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 3000;
      }
      .login-card {
        max-width: 420px;
        width: 90%;
        padding: 40px 30px;
        text-align: center;
        background-color: var(--card-background);
        border-radius: 15px;
        box-shadow: var(--shadow-lg);
        animation: bounceIn 0.6s ease-out;
      }
      @keyframes bounceIn {
        0% {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .login-card h2 {
        font-size: 2.2rem;
        margin-bottom: 20px;
      }
      .login-card p {
        color: var(--text-muted);
        margin-bottom: 30px;
        font-size: 1.05rem;
      }
      .login-logo {
        width: 100px; /* Ukuran logo di login */
        height: auto;
        margin-bottom: 25px;
      }
      .google-sign-in-btn {
        background-color: #ffffff;
        color: var(--text-dark);
        border: 1px solid var(--border-color);
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;

        /* PERBAIKAN: Ubah dari 'display: flex;' menjadi 'display: inline-flex;' */
        /* Ini memungkinkan tombol untuk diratakan oleh text-align: center; dari .login-card */
        display: inline-flex;
        align-items: center;
        justify-content: center;

        gap: 10px;
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
      }
      .google-sign-in-btn:hover {
        background-color: #f7f7f7;
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }
      .google-sign-in-btn img {
        width: 24px;
        height: 24px;
      }

      /* --- UPLOAD HISTORY --- */
      #uploadHistoryContainer {
        display: none;
        width: 100%;
        max-width: 700px; /* Lebar lebih besar untuk riwayat */
        margin-top: 25px;
      }
      #uploadHistoryContainer h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 2rem;
      }
      .history-list {
        background-color: var(--card-background);
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        padding: 20px;
      }
      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        transition: background-color 0.2s ease;
      }
      .history-item:last-child {
        border-bottom: none;
      }
      .history-item:hover {
        background-color: #f7f9fb;
      }
      .file-details {
        flex-grow: 1;
      }
      .file-details strong {
        display: block;
        font-weight: 600;
        font-size: 1.05rem;
        color: var(--text-dark);
        margin-bottom: 3px;
      }
      .file-details span {
        display: block;
        font-size: 0.85rem;
        color: var(--text-muted);
      }
      .delete-btn {
        background-color: var(--danger-color);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        margin-left: 15px;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      .delete-btn:hover {
        background-color: #c82333;
        transform: translateY(-1px);
      }
      .no-history-message {
        text-align: center;
        color: var(--text-muted);
        padding: 30px;
        font-size: 1.1rem;
      }

      /* --- MEDIA QUERIES UNTUK RESPONSIVITAS --- */

      @media (max-width: 768px) {
        body {
          padding-top: 140px; /* Sesuaikan untuk navbar yang mungkin dua baris */
        }
        .running-text-container span {
          font-size: 0.8rem;
        }

        .navbar {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
          padding: 10px 15px;
          min-height: auto; /* Biarkan tinggi menyesuaikan konten */
        }
        .navbar-brand {
          width: 100%;
          justify-content: center;
          margin-bottom: 10px;
        }
        .navbar-links {
          width: 100%;
          justify-content: space-around;
          margin-left: 0;
          border-top: 1px solid rgba(255, 255, 255, 0.2);
          padding-top: 10px;
          order: 3; /* Pindah link ke bawah info user */
        }
        .navbar-links a {
          font-size: 0.9rem;
          margin: 0 5px;
          flex-grow: 1;
          text-align: center;
        }
        .navbar-user-info {
          width: 100%;
          justify-content: flex-end;
          gap: 10px;
          font-size: 0.85rem;
          margin-bottom: 10px;
          order: 2; /* Di tengah antara brand dan link */
        }
        .navbar-user-info .user-name,
        .navbar-user-info .user-nim,
        .navbar-user-info .user-email {
          display: none; /* Sembunyikan detail teks, hanya tampilkan foto profil */
        }
        .logout-btn {
          padding: 6px 12px;
          font-size: 0.9rem;
        }
        .navbar-profile-img {
          width: 35px;
          height: 35px;
          border-width: 1px;
        }

        .header-info h1 {
          font-size: 1.2rem;
        }
        .header-info p {
          font-size: 0.85rem;
        }
        .card {
          padding: 20px;
        }
        h2 {
          font-size: 1.5rem;
        }
        .sub-text {
          font-size: 0.9rem;
        }
        .custom-file-upload {
          width: 150px;
          height: 150px;
        }
        .custom-file-upload img {
          width: 60px;
          height: 60px;
        }
        .custom-file-upload span {
          font-size: 0.85rem;
        }
        #uploadButton {
          padding: 10px 20px;
          font-size: 1rem;
        }

        .dialog-card {
          padding: 30px 20px;
        }
        .dialog-card h3 {
          font-size: 1.5rem;
        }
        .dialog-card p {
          font-size: 0.95rem;
        }
        .dialog-card .dialog-button {
          padding: 10px 20px;
          font-size: 1rem;
        }
        .dialog-card img,
        .dialog-card .dialog-icon {
          width: 60px;
          height: 60px;
          font-size: 3rem;
        }

        .login-card {
          padding: 30px 20px;
        }
        .login-card h2 {
          font-size: 1.8rem;
        }
        .login-card p {
          font-size: 0.95rem;
        }
        .login-logo {
          width: 80px;
        }

        .history-item {
          flex-direction: column;
          align-items: flex-start;
          padding: 12px;
          gap: 8px;
        }
        .file-details {
          width: 100%;
          margin-bottom: 0;
        }
        .delete-btn {
          width: 100%;
          margin-left: 0;
          padding: 10px 15px;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body class="flex flex-col min-h-screen">
    <div class="running-text-container fixed top-0 left-0 w-full text-white text-center text-sm font-semibold z-50 overflow-hidden whitespace-nowrap">
      <span> Selamat Datang di Portal Pengumpulan Tugas Teknologi Informasi UM-Palembang! Mendownload StarUml Gratis... </span>
    </div>

    <nav class="navbar fixed top-9 left-0 w-full flex justify-between items-center px-5 py-3 shadow-md z-40">
      <div class="flex items-center space-x-6">
        <a id="navHome" href="#" class="navbar-brand text-white no-underline"><img src="https://img.icons8.com/ios-filled/50/ffffff/home.png" alt="Home Icon" />Home</a>
        <a id="navHistory" href="#" class="navbar-brand text-white no-underline"><img src="https://img.icons8.com/ios-filled/50/ffffff/time-machine.png" alt="History Icon" />Riwayat Upload</a>
      </div>

      <div class="navbar-user-info flex items-center gap-3">
        <div class="text-right">
          <span class="user-name">M PUTRA RAMADHANI</span>
          <span class="user-nim">(162023023MPutraRamadhani)</span>
          <span class="user-email">putrasempolisi222@gmail.com</span>
        </div>
        <img id="userProfilePic" src="https://img.icons8.com/color/48/000000/guest-male--v1.png" alt="Profile Picture" class="navbar-profile-img" />
        <button id="logoutButton" class="logout-btn">Keluar</button>
      </div>
    </nav>

    <main id="mainContent" class="flex flex-col items-center flex-grow pt-8 pb-10 w-full">
      <div class="container mx-auto px-4">
        <div class="header-info card">
          <h1>PENGUMPULAN TUGAS TEKNOLOGI INFORMASI UM-PALEMBANG</h1>
          <p>Dibuat oleh M. Putra Ramadhani</p>
        </div>

        <div class="card">
          <h2 class="text-center">Unggah Dokumen</h2>
          <p class="sub-text text-center">Pilih file dokumen (PDF, DOCX, PPT, ZIP, 7z, dsb.) untuk diunggah.</p>

          <div class="form-group mb-6">
            <label for="courseSelect" class="block mb-2">Pilih Mata Kuliah:</label>
            <select id="courseSelect" class="w-full p-3 border rounded-lg" aria-label="Pilih Mata Kuliah">
              <option value="">-- Pilih salah satu --</option>
              <option value="Pemrograman Web">Pemrograman Web</option>
              <option value="Sistem Basis Data">Sistem Basis Data</option>
              <option value="Jaringan Komputer">Jaringan Komputer</option>
              <option value="Pengantar Teknologi Informasi">Pengantar Teknologi Informasi</option>
            </select>
          </div>

          <input type="file" id="fileInput" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx,.zip,.7z" />
          <div id="customFileUpload" class="custom-file-upload border-dashed border-2 rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer mx-auto">
            <img src="https://img.icons8.com/ios-filled/100/007bff/upload.png" alt="Upload Icon" />
            <span>Pilih Dokumen<br />atau Seret dan Lepas di Sini</span>
          </div>
          <p id="fileNameDisplay" class="file-name-display text-center"></p>

          <button id="uploadButton" class="upload-btn w-full py-3 rounded-lg mt-5">Unggah Sekarang</button>
        </div>
      </div>
    </main>

    <section id="uploadHistoryContainer" class="hidden w-full max-w-2xl mx-auto px-4 py-8">
      <h2 class="text-3xl font-bold text-center mb-6">Riwayat Unggahan</h2>
      <div id="historyList" class="history-list space-y-3">
        <p class="no-history-message">Belum ada riwayat unggahan.</p>
      </div>
    </section>

    <div id="termsDialog" class="dialog-container">
      <div class="dialog-card">
        <h3 class="text-2xl font-bold text-blue-600 mb-4">Syarat & Ketentuan</h3>
        <p class="text-gray-700 mb-6">Dengan menggunakan portal ini, Anda setuju untuk:</p>
        <ul class="text-left text-gray-800 space-y-2 mb-6 text-sm">
          <li class="flex items-center gap-2"><img src="https://img.icons8.com/ios-filled/24/28a745/checkmark--v1.png" alt="Checkmark" />Mengunggah tugas sesuai mata kuliah yang relevan.</li>
          <li class="flex items-center gap-2"><img src="https://img.icons8.com/ios-filled/24/28a745/checkmark--v1.png" alt="Checkmark" />Tidak mengunggah konten ilegal atau melanggar hak cipta.</li>
          <li class="flex items-center gap-2"><img src="https://img.icons8.com/ios-filled/24/28a745/checkmark--v1.png" alt="Checkmark" />Menjaga kerahasiaan akun Anda.</li>
          <li class="flex items-center gap-2"><img src="https://img.icons8.com/ios-filled/24/28a745/checkmark--v1.png" alt="Checkmark" />Mematuhi semua kebijakan akademik universitas.</li>
        </ul>
        <button id="acceptTermsButton" class="dialog-button">Saya Setuju & Lanjutkan</button>
      </div>
    </div>

    <div id="mainAccessClosedDialog" class="dialog-container">
      <div class="dialog-card">
        <img src="https://img.icons8.com/ios-filled/100/dc3545/lock.png" alt="Access Locked" class="mx-auto" />
        <h3 class="text-2xl font-bold text-red-600 mb-4">Akses Ditutup</h3>
        <p class="text-gray-700 mb-6">Maaf, portal utama belum dibuka. Silakan coba lagi nanti.</p>
        <button id="mainAccessOkButton" class="dialog-button">Oke</button>
      </div>
    </div>

    <div id="courseAccessClosedDialog" class="dialog-container">
      <div class="dialog-card">
        <img src="https://img.icons8.com/ios-filled/100/dc3545/lock.png" alt="Course Locked" class="mx-auto" />
        <h3 class="text-2xl font-bold text-red-600 mb-4">Mata Kuliah Ditutup</h3>
        <p class="text-gray-700 mb-6">Pengumpulan untuk mata kuliah ini telah ditutup atau belum dibuka.</p>
        <button id="courseAccessOkButton" class="dialog-button">Oke</button>
      </div>
    </div>

    <div id="uploadSuccessDialog" class="dialog-container">
      <div class="dialog-card">
        <img src="https://img.icons8.com/ios-filled/100/28a745/checked--v1.png" alt="Success Icon" class="mx-auto" />
        <h3 class="text-2xl font-bold text-green-600 mb-4">Unggahan Berhasil!</h3>
        <p class="text-gray-700 mb-6">Tugas Anda telah berhasil diunggah. Terima kasih!</p>
        <button id="successOkButton" class="dialog-button">Oke</button>
      </div>
    </div>

    <div id="uploadFailDialog" class="dialog-container">
      <div class="dialog-card">
        <img src="https://img.icons8.com/ios-filled/100/dc3545/multiply.png" alt="Error Icon" class="mx-auto" />
        <h3 class="text-2xl font-bold text-red-600 mb-4">Unggahan Gagal!</h3>
        <p class="text-gray-700 mb-6">Terjadi kesalahan saat mengunggah tugas Anda. Silakan coba lagi.</p>
        <button id="failOkButton" class="dialog-button">Oke</button>
      </div>
    </div>

    <div id="uploadTimerDialog" class="dialog-container">
      <div class="dialog-card">
        <i class="dialog-icon fas fa-hourglass-half text-blue-500 mb-5" style="color: var(--primary-color)"></i>
        <h3 class="text-2xl font-bold text-blue-600 mb-4">Waktu Pengumpulan</h3>
        <p class="text-gray-700 mb-4">Waktu tersisa untuk mengumpulkan tugas:</p>
        <p id="timerText" class="timer-text text-5xl font-extrabold mb-6">00:00:00</p>
        <button id="timerOkButton" class="dialog-button">Oke</button>
      </div>
    </div>

    <div id="authDialog" class="login-screen">
      <div class="login-card">
        <img src="https://img.icons8.com/ios-filled/100/007bff/graduation-cap.png" alt="Graduation Cap Logo" class="login-logo mx-auto" />
        <h2 class="text-4xl font-bold mb-4">Selamat Datang!</h2>
        <p class="text-gray-600 mb-8">Masuk untuk mengelola dan mengunggah tugas Anda.</p>
        <button id="googleSignInButton" class="google-sign-in-btn">
          <img src="https://img.icons8.com/color/48/4285F4/google-logo.png" alt="Google Icon" />
          Masuk dengan Google
        </button>
      </div>
    </div>

    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>
    <script>
      // ===============================================
      //           FIREBASE CONFIGURATION
      // ===============================================
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID",
      };

      firebase.initializeApp(firebaseConfig);

      const auth = firebase.auth();
      const db = firebase.firestore();
      const storage = firebase.storage();
      const googleProvider = new firebase.auth.GoogleAuthProvider();

      // ===============================================
      //           DOM ELEMENTS
      // ===============================================
      const authDialog = document.getElementById("authDialog");
      const googleSignInButton = document.getElementById("googleSignInButton");
      const mainContent = document.getElementById("mainContent");
      const uploadHistoryContainer = document.getElementById("uploadHistoryContainer");
      const logoutButton = document.getElementById("logoutButton");
      const fileInput = document.getElementById("fileInput");
      const customFileUpload = document.getElementById("customFileUpload");
      const fileNameDisplay = document.getElementById("fileNameDisplay");
      const uploadButton = document.getElementById("uploadButton");
      const courseSelect = document.getElementById("courseSelect");
      const historyList = document.getElementById("historyList");

      // Dialogs
      const termsDialog = document.getElementById("termsDialog");
      const acceptTermsButton = document.getElementById("acceptTermsButton");
      const mainAccessClosedDialog = document.getElementById("mainAccessClosedDialog");
      const mainAccessOkButton = document.getElementById("mainAccessOkButton");
      const courseAccessClosedDialog = document.getElementById("courseAccessClosedDialog");
      const courseAccessOkButton = document.getElementById("courseAccessOkButton");
      const uploadSuccessDialog = document.getElementById("uploadSuccessDialog");
      const successOkButton = document.getElementById("successOkButton");
      const uploadFailDialog = document.getElementById("uploadFailDialog");
      const failOkButton = document.getElementById("failOkButton");
      const uploadTimerDialog = document.getElementById("uploadTimerDialog");
      const timerText = document.getElementById("timerText");
      const timerOkButton = document.getElementById("timerOkButton");

      // Navbar links
      const navHome = document.getElementById("navHome");
      const navHistory = document.getElementById("navHistory");

      let currentUser = null;
      let selectedFile = null;
      let uploadInProgress = false; // Flag untuk mencegah multiple uploads
      let timerInterval = null; // Untuk menyimpan ID interval timer

      // ===============================================
      //           ACCESS CONTROL CONFIGURATION
      // ===============================================
      const accessConfig = {
        mainAccess: true, // true = open, false = closed
        courseAccess: {
          "Pemrograman Web": true,
          "Sistem Basis Data": true,
          "Jaringan Komputer": false, // Contoh: Jaringan Komputer ditutup
          "Pengantar Teknologi Informasi": true,
        },
        countdownDate: new Date("2024-12-31T23:59:59").getTime(), // Contoh deadline
      };

      // ===============================================
      //           AUTHENTICATION FUNCTIONS
      // ===============================================
      googleSignInButton.addEventListener("click", async () => {
        try {
          await auth.signInWithPopup(googleProvider);
        } catch (error) {
          console.error("Google Sign-In Error:", error);
          alert("Gagal masuk dengan Google. Silakan coba lagi.");
        }
      });

      logoutButton.addEventListener("click", async () => {
        try {
          await auth.signOut();
        } catch (error) {
          console.error("Logout Error:", error);
          alert("Gagal keluar. Silakan coba lagi.");
        }
      });

      auth.onAuthStateChanged((user) => {
        if (user) {
          currentUser = user;
          authDialog.classList.add("hidden"); // Sembunyikan dialog login
          showTermsDialogIfNeeded(); // Tampilkan dialog syarat jika belum diterima
          updateUserInfo(user);
          showView("home");
          startCountdown(); // Mulai timer saat login
        } else {
          currentUser = null;
          authDialog.classList.remove("hidden"); // Tampilkan dialog login
          mainContent.style.display = "none";
          uploadHistoryContainer.style.display = "none";
          // Hentikan timer saat logout
          if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
          }
        }
      });

      function updateUserInfo(user) {
        document.querySelector(".navbar-user-info .user-name").textContent = user.displayName;
        document.querySelector(".navbar-user-info .user-email").textContent = user.email;
        // Jika Anda memiliki NIM, Anda perlu menyimpannya di Firestore atau tempat lain
        // dan mengambilnya di sini. Untuk saat ini, kita bisa dummy atau kosongkan.
        document.querySelector(".navbar-user-info .user-nim").textContent = "(NIM Belum Tersedia)";

        const userProfilePic = document.getElementById("userProfilePic");
        if (user.photoURL) {
          userProfilePic.src = user.photoURL;
        } else {
          userProfilePic.src = "https://img.icons8.com/color/48/000000/guest-male--v1.png"; // Default icon
        }
      }

      // ===============================================
      //           TERMS & ACCESS CONTROL
      // ===============================================
      async function showTermsDialogIfNeeded() {
        if (!currentUser) return;

        const userDocRef = db.collection("users").doc(currentUser.uid);
        const doc = await userDocRef.get();

        if (doc.exists && doc.data().termsAccepted) {
          checkMainAccess();
        } else {
          termsDialog.classList.add("show");
        }
      }

      acceptTermsButton.addEventListener("click", async () => {
        if (!currentUser) return;
        const userDocRef = db.collection("users").doc(currentUser.uid);
        await userDocRef.set({ termsAccepted: true }, { merge: true });
        termsDialog.classList.remove("show");
        checkMainAccess();
      });

      function checkMainAccess() {
        if (!accessConfig.mainAccess) {
          mainAccessClosedDialog.classList.add("show");
          mainContent.style.display = "none";
          uploadHistoryContainer.style.display = "none";
        } else {
          mainAccessClosedDialog.classList.remove("show");
          mainContent.style.display = "block";
        }
      }

      mainAccessOkButton.addEventListener("click", () => {
        mainAccessClosedDialog.classList.remove("show");
      });
      courseAccessOkButton.addEventListener("click", () => {
        courseAccessClosedDialog.classList.remove("show");
      });
      successOkButton.addEventListener("click", () => {
        uploadSuccessDialog.classList.remove("show");
        // Reset form setelah sukses
        resetUploadForm();
        fetchUploadHistory(currentUser.uid);
      });
      failOkButton.addEventListener("click", () => {
        uploadFailDialog.classList.remove("show");
      });
      timerOkButton.addEventListener("click", () => {
        uploadTimerDialog.classList.remove("show");
      });

      // ===============================================
      //           UPLOAD FUNCTIONS
      // ===============================================
      customFileUpload.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", (event) => {
        selectedFile = event.target.files[0];
        if (selectedFile) {
          fileNameDisplay.textContent = `File dipilih: ${selectedFile.name}`;
          uploadButton.disabled = false;
        } else {
          fileNameDisplay.textContent = "";
          uploadButton.disabled = true;
        }
      });

      // Drag and Drop
      customFileUpload.addEventListener("dragover", (event) => {
        event.preventDefault();
        customFileUpload.classList.add("border-blue-500");
      });

      customFileUpload.addEventListener("dragleave", (event) => {
        event.preventDefault();
        customFileUpload.classList.remove("border-blue-500");
      });

      customFileUpload.addEventListener("drop", (event) => {
        event.preventDefault();
        customFileUpload.classList.remove("border-blue-500");
        selectedFile = event.dataTransfer.files[0];
        if (selectedFile) {
          fileNameDisplay.textContent = `File dipilih: ${selectedFile.name}`;
          uploadButton.disabled = false;
          fileInput.files = event.dataTransfer.files; // Update fileInput
        } else {
          fileNameDisplay.textContent = "";
          uploadButton.disabled = true;
        }
      });

      uploadButton.addEventListener("click", async () => {
        if (!currentUser || !selectedFile || uploadInProgress) {
          alert("Silakan pilih file dan pastikan Anda login.");
          return;
        }

        const course = courseSelect.value;
        if (!course) {
          alert("Silakan pilih mata kuliah terlebih dahulu.");
          return;
        }

        if (!accessConfig.courseAccess[course]) {
          courseAccessClosedDialog.classList.add("show");
          return;
        }

        uploadInProgress = true;
        uploadButton.disabled = true;
        uploadButton.textContent = "Mengunggah...";

        const storageRef = storage.ref();
        const fileExtension = selectedFile.name.split(".").pop();
        const fileName = `${currentUser.uid}_${course}_${Date.now()}.${fileExtension}`;
        const fileRef = storageRef.child(`uploads/${fileName}`);

        const uploadTask = fileRef.put(selectedFile);

        uploadTask.on(
          "state_changed",
          (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log("Upload is " + progress + "% done");
            // Anda bisa menampilkan progress bar di sini jika diinginkan
          },
          (error) => {
            console.error("Upload failed:", error);
            uploadFailDialog.classList.add("show");
            uploadInProgress = false;
            uploadButton.disabled = false;
            uploadButton.textContent = "Unggah Sekarang";
          },
          async () => {
            try {
              const downloadURL = await fileRef.getDownloadURL();
              await db.collection("uploads").add({
                userId: currentUser.uid,
                userName: currentUser.displayName,
                userEmail: currentUser.email,
                fileName: selectedFile.name,
                fileType: selectedFile.type,
                fileSize: selectedFile.size,
                course: course,
                uploadDate: firebase.firestore.FieldValue.serverTimestamp(),
                downloadURL: downloadURL,
              });
              uploadSuccessDialog.classList.add("show");
            } catch (error) {
              console.error("Error saving upload data or getting URL:", error);
              uploadFailDialog.classList.add("show");
            } finally {
              uploadInProgress = false;
              uploadButton.disabled = false; // Akan di-reset oleh resetUploadForm
              uploadButton.textContent = "Unggah Sekarang";
            }
          }
        );
      });

      function resetUploadForm() {
        fileInput.value = ""; // Clear selected file
        selectedFile = null;
        fileNameDisplay.textContent = "";
        courseSelect.value = "";
        uploadButton.disabled = true;
      }

      // ===============================================
      //           UPLOAD HISTORY FUNCTIONS
      // ===============================================
      async function fetchUploadHistory(userId) {
        historyList.innerHTML = '<p class="text-center text-gray-500 py-5">Memuat riwayat...</p>'; // Loading state
        try {
          const snapshot = await db.collection("uploads").where("userId", "==", userId).orderBy("uploadDate", "desc").get();

          historyList.innerHTML = ""; // Clear previous history

          if (snapshot.empty) {
            historyList.innerHTML = '<p class="no-history-message">Belum ada riwayat unggahan.</p>';
            return;
          }

          snapshot.forEach((doc) => {
            const data = doc.data();
            const uploadDate = data.uploadDate ? data.uploadDate.toDate().toLocaleString() : "N/A";

            const historyItem = document.createElement("div");
            historyItem.classList.add("history-item", "flex", "items-center", "justify-between", "py-3", "px-4", "border-b");
            historyItem.innerHTML = `
                <div class="file-details">
                    <strong>${data.fileName}</strong>
                    <span>Mata Kuliah: ${data.course}</span>
                    <span>Diunggah: ${uploadDate}</span>
                </div>
                <button data-id="${doc.id}" data-path="uploads/${data.userId}_${data.course}_${new Date(data.uploadDate.toDate()).getTime()}.${data.fileName.split(".").pop()}" class="delete-btn">Hapus</button>
            `;
            historyList.appendChild(historyItem);
          });

          // Add event listeners for delete buttons
          historyList.querySelectorAll(".delete-btn").forEach((button) => {
            button.addEventListener("click", deleteUpload);
          });
        } catch (error) {
          console.error("Error fetching upload history:", error);
          historyList.innerHTML = '<p class="text-center text-red-500 py-5">Gagal memuat riwayat.</p>';
        }
      }

      async function deleteUpload(event) {
        const docId = event.target.dataset.id;
        const filePath = event.target.dataset.path; // Path to the file in Firebase Storage

        if (!confirm("Apakah Anda yakin ingin menghapus unggahan ini?")) {
          return;
        }

        try {
          // Delete from Firestore
          await db.collection("uploads").doc(docId).delete();

          // Delete from Firebase Storage
          const fileRef = storage.ref(filePath);
          await fileRef.delete();

          alert("Unggahan berhasil dihapus!");
          fetchUploadHistory(currentUser.uid); // Refresh history
        } catch (error) {
          console.error("Error deleting upload:", error);
          alert("Gagal menghapus unggahan. " + error.message);
        }
      }

      // ===============================================
      //           VIEW MANAGEMENT (NAVBAR)
      // ===============================================
      function showView(view) {
        mainContent.style.display = "none";
        uploadHistoryContainer.style.display = "none";

        navHome.classList.remove("active");
        navHistory.classList.remove("active");

        if (view === "home") {
          mainContent.style.display = "block";
          navHome.classList.add("active");
        } else if (view === "history") {
          uploadHistoryContainer.style.display = "block";
          if (currentUser) {
            fetchUploadHistory(currentUser.uid);
          }
          navHistory.classList.add("active");
        }
      }

      navHome.addEventListener("click", (e) => {
        e.preventDefault();
        showView("home");
      });

      navHistory.addEventListener("click", (e) => {
        e.preventDefault();
        showView("history");
      });

      // ===============================================
      //           COUNTDOWN TIMER
      // ===============================================
      function startCountdown() {
        if (timerInterval) clearInterval(timerInterval); // Clear existing timer
        timerInterval = setInterval(updateCountdown, 1000);
      }

      function updateCountdown() {
        const now = new Date().getTime();
        const distance = accessConfig.countdownDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        const formattedTime = `${days}d ${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

        if (distance < 0) {
          clearInterval(timerInterval);
          timerText.textContent = "Waktu Habis!";
          timerText.classList.add("text-red-500");
          // Optionally, disable uploads or show a message
        } else {
          timerText.textContent = formattedTime;
          timerText.classList.remove("text-red-500");
          timerText.classList.add("text-blue-600"); // Warna normal untuk timer
        }
      }
    </script>
  </body>
</html>
